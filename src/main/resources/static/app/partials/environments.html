<!--

    Copyright (c) 2014 - 2015 Ventiv Technology

    Licensed under the Apache License, Version 2.0 (the "License"); you may not
    use this file except in compliance with the License. You may obtain a copy of
    the License at

    http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
    WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
    License for the specific language governing permissions and limitations under
    the License.

-->
<div class="container" id="hosts-details" cg-busy="asyncExecutionPromise">
    <div id="environment-header" data-ng-show="isMultipleTiers()">
        <span class="environment-title" translate="ENVIRONMENT">Environment</span>: <span class="environment-description">{{environment.description}}</span>

        <hr>
    </div>

    <accordion close-others="false" is-open="true">
        <accordion-group data-ng-repeat="application in environment.applications">
            <accordion-heading>
                <span id="{{application.id}}-app">{{application.description}}</span>
                <span data-ng-show="application.buildStatus.building"> - <a href="" translate="BUILDING_IMAGE">Building Image...</a></span>
                <span data-ng-show="application.deploymentInProgress"> - <a href="" translate="DEPLOYING">Deploying...</a></span>
                <span class="pull-right">(Running: {{getRunning(application).length}}, Stopped: {{getStopped(application).length}}, Missing: {{application.missingServiceInstances.length}})</span>
            </accordion-heading>
            <div id="{{application.id}}-url">
                <div class="row">
                    <div class="col-md-2" translate="URL">URL:</div>
                    <div class="col-md-10"><a href="{{application.url}}">{{application.url}}</a></div>
                </div>

                <div class="row">
                    <div class="col-md-2" translate="DEPLOYED_BUILD">Deployed Build:</div>
                    <div class="col-md-10">{{application.version}}</div>
                </div>

                <hr>

                <div class="row">
                    <div class="col-md-2 col-md-offset-1">
                        <select class="version-selection form-control" data-application="application"></select>
                    </div>
                    <div class="col-md-1"><button class="btn btn-primary btn-block" data-ng-show="!application.deploymentInProgress && !application.buildStatus.building" data-ng-click="deployApplication(application)" translate="DEPLOY">Deploy</button></div>
                    <div class="col-md-1"><button class="btn btn-warning btn-block" data-ng-click="statusChangeApplication(application, 'stop')" translate="STOP">Stop</button></div>
                    <div class="col-md-1"><button class="btn btn-warning btn-block" data-ng-click="statusChangeApplication(application, 'start')" translate="START">Start</button></div>
                    <div class="col-md-1"><button class="btn btn-warning btn-block" data-ng-click="statusChangeApplication(application, 'restart')" translate="RESTART">Restart</button></div>
                </div>

                <div data-ng-show="application.buildStatus.building" id="build-info">
                    <hr>

                    <div class="row" data-ng-repeat="(buildingService, buildingServiceStatus) in application.buildStatus.serviceBuildStatus">
                        <div class="col-md-2">{{buildingService}}:</div>
                        <div class="col-md-10">{{buildingServiceStatus}}</div>
                    </div>
                </div>

                <hr>

                <div class="env-service-instance" data-ng-repeat="serviceInstance in application.serviceInstances">
                    <div data-ng-class="[serviceInstanceButtonSizeClass(application)]">
                        <div class="btn btn-block" data-ng-click="serviceInstanceDetails(serviceInstance)" data-ng-class="{'btn-success': serviceInstance.status == 'Running', 'btn-danger': serviceInstance.status == 'Stopped'}">
                            <span>{{serviceInstance.serviceDescription}} on</span>
                            <span>{{serviceInstance.serverName}}</span>
                            <span>[{{serviceInstance.containerImage.tag}} - deployed @ {{serviceInstance.containerCreatedDate | date:'short'}} - {{serviceInstance.containerStatus}}]</span>
                        </div>
                    </div>
                    <div data-ng-repeat="(metricName, metricValue) in serviceInstance.additionalMetrics" data-ng-if="serviceInstance.additionalMetrics && serviceInstance.status == 'Running'" class="col-md-2">
                        <div class="btn btn-info btn-block"  data-ng-include="'/api/service/' + serviceInstance.name + '/metrics/' + metricName + '/button'"></div>
                    </div>
                </div>

                <hr>

                <div class="env-missing-service-instance" data-ng-repeat="missingService in application.missingServiceInstances track by $index">
                    <div data-ng-class="[serviceInstanceButtonSizeClass(application)]">
                        <div class="btn btn-warning btn-block">{{missingService.serviceDescription}} Missing</div>
                    </div>
                </div>

            </div>
        </accordion-group>
    </accordion>
</div> <!-- /container -->

